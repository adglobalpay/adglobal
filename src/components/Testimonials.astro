---
interface Review {
  author: string;
  date: string;      // YYYY-MM-DD
  rating: number;    // 1..5
  text: string;
  avatar?: string;   // /assets/...
  url: string;       // link al review (Google, etc.)
  source?: "google" | "facebook" | "custom";
}

const { reviews = [], seeAllUrl = "#" } = Astro.props as {
  reviews?: Review[];
  seeAllUrl?: string;
};

// demo (borra si pasas por props)
const demo = reviews.length ? reviews : [
  {
    author: "Anderson Hern√†ndez",
    date: "2025-07-28",
    rating: 5,
    text: "Excellent service, 100% recommended.",
    avatar: "/public/anderson.png",
    url: "https://www.google.com/maps/contrib/111052014790559477700/place/ChIJGwGVk4CsDGUR7mVUkvqeMa8/@37.3592834,-127.0620127,208766m/data=!3m1!1e3!4m6!1m5!8m4!1e1!2s111052014790559477700!3m1!1e1?hl=en&entry=ttu&g_ep=EgoyMDI1MDgwNi4wIKXMDSoASAFQAw%3D%3D",
    source: "google"
  },
  {
    author: "Orianis del valle Zurita",
    date: "2025-07-18",
    rating: 5,
    text: "Excelente servicio recomendado al 100% En responsabilidad y puntualidad much√≠simas bendicionesüôèsigamos por mas",
    avatar: "/public/orianis.png",
    url: "https://www.google.com/maps/contrib/112089206082978181459/place/ChIJGwGVk4CsDGUR7mVUkvqeMa8/@37.3592834,-127.0620127,208766m/data=!3m1!1e3!4m6!1m5!8m4!1e1!2s112089206082978181459!3m1!1e1?hl=en&entry=ttu&g_ep=EgoyMDI1MDgwNi4wIKXMDSoASAFQAw%3D%3D",
    source: "google"
  },
  {
    author: "Jose Castro",
    date: "2025-07-15",
    rating: 5,
    text: "Excelente servicio, muy confiables y serios, üíØ recomendables",
    avatar: "/public/jose.png",
    url: "https://www.google.com/maps/contrib/107349572692930073194/place/ChIJGwGVk4CsDGUR7mVUkvqeMa8/@37.3592834,-126.4440317,13048m/data=!3m1!1e3!4m6!1m5!8m4!1e1!2s107349572692930073194!3m1!1e1?hl=en&entry=ttu&g_ep=EgoyMDI1MDgwNi4wIKXMDSoASAFQAw%3D%3D",
    source: "google"
  },
  {
    author: "Jeandy Diaz",
    date: "2025-07-12",
    rating: 5,
    text: "Excelente servicio.. responsabilidad 100% garantizada",
    avatar: "/public/jeandy.png",
    url: "https://www.google.com/maps/contrib/115244030168881921008/place/ChIJGwGVk4CsDGUR7mVUkvqeMa8/@37.3592834,-127.0620127,208766m/data=!3m1!1e3!4m6!1m5!8m4!1e1!2s115244030168881921008!3m1!1e1?hl=en&entry=ttu&g_ep=EgoyMDI1MDgwNi4wIKXMDSoASAFQAw%3D%3D",
    source: "google"
  },
  {
    author: "Liz Monagas",
    date: "2025-07-12",
    rating: 5,
    text: "Excelente servicio,  r√°pido y eficaz.  Muchas gracias AD Global x la atenci√≥n y responsabilidad.",
    avatar: "/public/liz.png",
    url: "https://www.google.com/maps/contrib/100443016051532172130/place/ChIJGwGVk4CsDGUR7mVUkvqeMa8/@37.3592834,-127.0620127,208766m/data=!3m1!1e3!4m6!1m5!8m4!1e1!2s100443016051532172130!3m1!1e1?hl=en&entry=ttu&g_ep=EgoyMDI1MDgwNi4wIKXMDSoASAFQAw%3D%3D",
    source: "google"
  },
  {
    author: "Yolymar Mosqueda",
    date: "2025-07-02",
    rating: 5,
    text: "Excelente servicio, respuesta inmediata",
    avatar: "/public/yolymar.png",
    url: "https://www.google.com/maps/contrib/115847963760010935894/place/ChIJGwGVk4CsDGUR7mVUkvqeMa8/@37.3592834,-129.0395518,835064m/data=!3m1!1e3!4m6!1m5!8m4!1e1!2s115847963760010935894!3m1!1e1?hl=en&entry=ttu&g_ep=EgoyMDI1MDgwNi4wIKXMDSoASAFQAw%3D%3D",
    source: "google"
  }
];
---
<section id="resenas" class="relative bg-gradient-to-b from-white to-sky-50 py-4 sm:py-8">
  <div class="mx-auto max-w-6xl px-4">
    <div class="mb-3 sm:mb-5 flex items-end justify-between gap-4">
      <div>
        <h2 class="text-lg sm:text-2xl md:text-3xl font-bold">Opiniones de clientes</h2>
        <p class="text-[11px] sm:text-sm">Toca una tarjeta para ver el review completo.</p>
      </div>

      <!-- Flechas solo ‚â• sm -->
      <div class="hidden sm:flex items-center gap-2">
        <button id="reviews-prev" aria-label="Anterior"
          class="rounded-full border bg-white px-3 py-2 shadow hover:bg-gray-50">
          <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
        </button>
        <button id="reviews-next" aria-label="Siguiente"
          class="rounded-full border bg-white px-3 py-2 shadow hover:bg-gray-50">
          <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        </button>
      </div>
    </div>

    <div class="relative min-h-0"> <!-- evita ‚Äúgutter‚Äù en iOS -->
      <!-- bordes gradiente solo ‚â• sm -->
      <div class="pointer-events-none absolute left-0 top-0 h-full w-10 bg-gradient-to-r from-white to-transparent hidden sm:block"></div>
      <div class="pointer-events-none absolute right-0 top-0 h-full w-10 bg-gradient-to-l from-white to-transparent hidden sm:block"></div>

      <ul
        id="reviews-scroller"
        class="flex snap-x snap-mandatory gap-3 sm:gap-6 overflow-x-auto scroll-smooth pb-1 sm:pb-2
               [-ms-overflow-style:none] [scrollbar-width:none] min-h-0"
        style="scrollbar-width:none"
      >
        {demo.map((r) => (
          <li class="snap-center">
            <a href={r.url} target="_blank" rel="noopener"
               class="block w-[82vw] xs:w-[78vw] sm:w-[420px] rounded-2xl border bg-white p-4 sm:p-5 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md">
              <div class="mb-2 sm:mb-3 flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <img src={r.avatar || "/assets/avatars/default.png"} alt={r.author}
                       class="h-8 w-8 sm:h-9 sm:w-9 rounded-full object-cover" loading="lazy" />
                  <div>
                    <p class="text-sm sm:text-base font-medium">{r.author}</p>
                    <p class="text-[10px] sm:text-xs text-gray-500">{r.date}</p>
                  </div>
                </div>
                {r.source === "google" && (
                  <svg viewBox="0 0 24 24" class="h-4 w-4 sm:h-5 sm:w-5"><path fill="#4285F4" d="M21.35 11.1H12v2.9h5.3c-.23 1.45-1.6 4.25-5.3 4.25-3.19 0-5.8-2.64-5.8-5.9s2.61-5.9 5.8-5.9c1.81 0 3.03.77 3.73 1.44l2.55-2.46C16.47 3.67 14.43 2.8 12 2.8 6.92 2.8 2.8 6.92 2.8 12s4.12 9.2 9.2 9.2c5.31 0 8.82-3.73 8.82-8.99 0-.6-.07-.99-.17-1.11Z"/></svg>
                )}
              </div>

              <div class="mb-2 sm:mb-3 flex items-center gap-1 text-amber-400">
                {Array.from({ length: r.rating }).map(() => (
                  <svg viewBox="0 0 20 20" class="h-3.5 w-3.5 sm:h-4 sm:w-4 fill-current"><path d="M10 15l-5.878 3.09 1.122-6.545L.488 6.91l6.563-.954L10 0l2.949 5.956 6.563.954-4.756 4.635 1.122 6.545z"/></svg>
                ))}
              </div>

              <p class="text-[13px] sm:text-sm text-gray-700 line-clamp-4">{r.text}</p>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </div>
</section>


<script is:inline>
  const scroller = document.getElementById('reviews-scroller');
  const prev = document.getElementById('reviews-prev');
  const next = document.getElementById('reviews-next');
  const gap = 24;

  function cardWidth() {
    const first = scroller?.querySelector('li');
    return first ? first.getBoundingClientRect().width + gap : 360;
  }

  prev?.addEventListener('click', () => {
    scroller?.scrollBy({ left: -cardWidth(), behavior: 'smooth' });
  });
  next?.addEventListener('click', () => {
    scroller?.scrollBy({ left: cardWidth(), behavior: 'smooth' });
  });
</script>
